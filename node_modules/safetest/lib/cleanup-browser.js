"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cleanupBrowser = void 0;
const state_1 = require("./state");
const ignoreError = (promise) => promise?.catch(() => { });
const cleanupBrowser = async () => {
    const context = state_1.state.browserContextInstance;
    if (!context)
        return;
    const browser = context.browser();
    let connected = true;
    browser?.once('disconnected', () => (connected = false));
    const pages = context.pages() ?? [];
    for (const page of pages) {
        const hooks = page._safetest_internal?.hooks;
        for (const beforeClose of hooks?.beforeClose ?? []) {
            await ignoreError(beforeClose(page));
        }
        await ignoreError(page.close());
    }
    await ignoreError(context?.close());
    const docker = state_1.state.options.useDocker;
    if (!docker && connected && browser?.isConnected()) {
        await ignoreError(browser?.close());
    }
    delete state_1.state.browserContextInstance;
};
exports.cleanupBrowser = cleanupBrowser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xlYW51cC1icm93c2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsZWFudXAtYnJvd3Nlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxtQ0FBZ0M7QUFFaEMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxPQUFzQixFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO0FBRWxFLE1BQU0sY0FBYyxHQUFHLEtBQUssSUFBbUIsRUFBRTtJQUN0RCxNQUFNLE9BQU8sR0FBRyxhQUFLLENBQUMsc0JBQXNCLENBQUM7SUFDN0MsSUFBSSxDQUFDLE9BQU87UUFBRSxPQUFPO0lBQ3JCLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNsQyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUM7SUFDckIsT0FBTyxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUV6RCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDO0lBQ3BDLEtBQUssTUFBTSxJQUFJLElBQUksS0FBbUIsRUFBRTtRQUN0QyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDO1FBQzdDLEtBQUssTUFBTSxXQUFXLElBQUksS0FBSyxFQUFFLFdBQVcsSUFBSSxFQUFFLEVBQUU7WUFDbEQsTUFBTSxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDdEM7UUFDRCxNQUFNLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztLQUNqQztJQUNELE1BQU0sV0FBVyxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBRXBDLE1BQU0sTUFBTSxHQUFHLGFBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO0lBQ3ZDLElBQUksQ0FBQyxNQUFNLElBQUksU0FBUyxJQUFJLE9BQU8sRUFBRSxXQUFXLEVBQUUsRUFBRTtRQUNsRCxNQUFNLFdBQVcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztLQUNyQztJQUVELE9BQU8sYUFBSyxDQUFDLHNCQUFzQixDQUFDO0FBQ3RDLENBQUMsQ0FBQztBQXZCVyxRQUFBLGNBQWMsa0JBdUJ6QiJ9