"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.bootstrap = exports.render = void 0;
const state_1 = require("./state");
const render_1 = require("./render");
const bootstrap_1 = require("./bootstrap");
let renderFn;
const errorMessage = `App is not bootstrapped, did you forget to call \`bootstrap({ /* ... */ })\`?`;
const assertAndRender = (element, options) => {
    if (!renderFn)
        throw new Error(errorMessage);
    return renderFn(element, options);
};
const defaultRender = (app) => app;
async function render(elementToRender = defaultRender, options = {}) {
    if (typeof elementToRender === 'function') {
        const rendered = elementToRender(state_1.state.browserState?.renderElement.value ?? {});
        elementToRender = rendered;
    }
    return (0, render_1.render)({ __isRenderable: true, thing: elementToRender }, options, async (e) => assertAndRender(e.thing, options.props));
}
exports.render = render;
const bootstrap = async (args) => {
    renderFn = args.render;
    state_1.state.browserState = {
        retryAttempt: 0,
        renderElement: { __type: 'renderElement', value: args.element },
    };
    return (0, bootstrap_1.bootstrap)({
        ...args,
        defaultRender: () => assertAndRender(args.element, args.options?.props),
    });
};
exports.bootstrap = bootstrap;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidnVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Z1ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtQ0FBZ0M7QUFDaEMscUNBQWlFO0FBQ2pFLDJDQUFxRTtBQXlCckUsSUFBSSxRQUFrQixDQUFDO0FBQ3ZCLE1BQU0sWUFBWSxHQUFHLCtFQUErRSxDQUFDO0FBQ3JHLE1BQU0sZUFBZSxHQUFhLENBQUMsT0FBbUIsRUFBRSxPQUFPLEVBQUUsRUFBRTtJQUNqRSxJQUFJLENBQUMsUUFBUTtRQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0MsT0FBTyxRQUFRLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3BDLENBQUMsQ0FBQztBQUVGLE1BQU0sYUFBYSxHQUFHLENBQUMsR0FBZSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7QUFFeEMsS0FBSyxVQUFVLE1BQU0sQ0FDMUIsa0JBRXdDLGFBQWEsRUFDckQsVUFBNEIsRUFBRTtJQUU5QixJQUFJLE9BQU8sZUFBZSxLQUFLLFVBQVUsRUFBRTtRQUN6QyxNQUFNLFFBQVEsR0FBSSxlQUF1QixDQUN2QyxhQUFLLENBQUMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxLQUFLLElBQUssRUFBVSxDQUN2RCxDQUFDO1FBQ0YsZUFBZSxHQUFHLFFBQVEsQ0FBQztLQUM1QjtJQUVELE9BQU8sSUFBQSxlQUFZLEVBQ2pCLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLEVBQ2hELE9BQU8sRUFDUCxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQ3JELENBQUM7QUFDSixDQUFDO0FBbEJELHdCQWtCQztBQVdNLE1BQU0sU0FBUyxHQUFHLEtBQUssRUFDNUIsSUFBNEIsRUFDUixFQUFFO0lBQ3RCLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3ZCLGFBQUssQ0FBQyxZQUFZLEdBQUc7UUFDbkIsWUFBWSxFQUFFLENBQUM7UUFDZixhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFO0tBQ2hFLENBQUM7SUFFRixPQUFPLElBQUEscUJBQWUsRUFBQztRQUNyQixHQUFHLElBQUk7UUFDUCxhQUFhLEVBQUUsR0FBRyxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUM7S0FDeEUsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBYlcsUUFBQSxTQUFTLGFBYXBCIn0=