"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Suite = exports.statusIcons = exports.SuiteStatuses = void 0;
const react_1 = __importDefault(require("react"));
const report_1 = require("./report");
const SuiteStatuses = ({ suite, }) => {
    const { Chip } = react_1.default.useContext(report_1.ComponentsContext);
    const statuses = getStatusesCount(suite);
    return (react_1.default.createElement("div", { style: { display: 'inline-flex', alignItems: 'center' } }, getStatusesText(statuses).map((label) => (react_1.default.createElement(Chip, { key: label, label: label })))));
};
exports.SuiteStatuses = SuiteStatuses;
const getStatusesText = (statuses) => Object.entries(statuses).map(([status, count]) => {
    return `${count > 1 ? `${count}x ` : ''}${exports.statusIcons[status]}`;
});
const getTestStatuses = (tests, statuses = {}) => {
    for (const test of tests) {
        const status = test.status;
        statuses[status] = (statuses[status] || 0) + 1;
    }
    return getStatusesText(statuses);
};
const getStatusesCount = (suite, statuses = {}) => {
    const suites = Object.values(suite.suites);
    const tests = Object.values(suite.tests);
    for (const test of tests) {
        const status = test.status;
        statuses[status] = (statuses[status] || 0) + 1;
    }
    for (const suite of suites) {
        getStatusesCount(suite, statuses);
    }
    return statuses;
};
exports.statusIcons = {
    passed: '✅',
    failed: '❌',
    pending: '⏱',
    skipped: '⏭',
    todo: '📝',
    disabled: '🚫',
    empty: '📭',
};
const showSuite = (suite, showing) => {
    const counts = getStatusesCount(suite);
    if (showing !== 'all' && !counts[showing]) {
        return false;
    }
    return true;
};
const Suite = ({ suite }) => {
    const { Accordion, Label, Test } = react_1.default.useContext(report_1.ComponentsContext);
    const suites = Object.values(suite.suites);
    const tests = Object.values(suite.tests);
    const showing = react_1.default.useContext(report_1.StateContext).viewing;
    if (!showSuite(suite, showing))
        return null;
    const subSuites = suites.filter((subSuite) => showSuite(subSuite, showing));
    if (!subSuites.length) {
        return tests
            .filter((t) => (showing === 'all' ? true : t.status === showing))
            .map((test) => react_1.default.createElement(Test, { key: test.id, test: test }));
    }
    return (react_1.default.createElement(react_1.default.Fragment, null,
        subSuites.map((subSuite) => (react_1.default.createElement(Accordion, { defaultOpen: true, key: subSuite.name, summary: react_1.default.createElement(react_1.default.Fragment, null,
                react_1.default.createElement(exports.SuiteStatuses, { suite: subSuite }),
                " ",
                react_1.default.createElement(Label, null, "Suite: "),
                subSuite.name) },
            react_1.default.createElement(exports.Suite, { key: subSuite.id, suite: subSuite })))),
        tests.length > 0 && (react_1.default.createElement(Accordion, { defaultOpen: true, summary: react_1.default.createElement(Label, null,
                getTestStatuses(tests),
                " Tests") }, tests
            .filter((t) => (showing === 'all' ? true : t.status === showing))
            .map((test) => (react_1.default.createElement(Test, { key: test.id, test: test })))))));
};
exports.Suite = Suite;
