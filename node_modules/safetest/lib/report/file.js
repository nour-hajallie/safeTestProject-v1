"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.File = void 0;
const react_1 = __importDefault(require("react"));
const suite_1 = require("./suite");
const report_1 = require("./report");
const createNestedSuite = (file) => {
    const filename = file.filename;
    const suitesById = {};
    const statuses = {};
    const suites = {};
    const tests = {};
    const fileSuite = { id: filename, name: filename, suites, tests };
    for (const result of file.assertionResults) {
        const { ancestorTitles, title } = result;
        let suite = fileSuite;
        for (const ancestorTitle of ancestorTitles) {
            const id = `${suite.id} > ${ancestorTitle}`;
            if (!suite.suites[ancestorTitle]) {
                const name = ancestorTitle;
                const newSuite = { id, name, suites: {}, tests: {}, parent: suite };
                suitesById[id] = newSuite;
                suite.suites[ancestorTitle] = newSuite;
            }
            suite = suite.suites[ancestorTitle];
        }
        const id = `${suite.id} > ${result.title}`;
        const test = { ...result, id, parent: suite };
        suite.tests[title] = test;
        statuses[id] = test.status;
    }
    return {
        filename,
        suite: fileSuite,
        suiteIds: Object.keys(suitesById),
        statuses,
    };
};
const File = ({ file }) => {
    const suite = react_1.default.useMemo(() => createNestedSuite(file), [file]);
    const { Accordion, Suite, Label } = react_1.default.useContext(report_1.ComponentsContext);
    const showing = react_1.default.useContext(report_1.StateContext).viewing;
    let isViewing = false;
    for (const status of Object.values(suite.statuses)) {
        if (showing === 'all' || showing === status) {
            isViewing = true;
            break;
        }
    }
    if (!isViewing)
        return null;
    return (react_1.default.createElement(Accordion, { summary: react_1.default.createElement(react_1.default.Fragment, null,
            react_1.default.createElement(suite_1.SuiteStatuses, { suite: suite.suite }),
            " ",
            react_1.default.createElement(Label, null, "File: "),
            suite.filename), defaultOpen: true },
        react_1.default.createElement(Suite, { suite: suite.suite })));
};
exports.File = File;
