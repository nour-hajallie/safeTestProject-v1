"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.afterAllFn = exports.afterEachFn = void 0;
/* eslint-disable @typescript-eslint/ban-types */
const cleanup_browser_1 = require("./cleanup-browser");
const state_1 = require("./state");
const afterEachFn = async () => {
    const pages = state_1.state.browserContextInstance?.pages() ?? [];
    for (const [_index, page] of Object.entries(pages)) {
        const index = +_index;
        const hooks = page._safetest_internal?.hooks;
        const toRemove = [];
        for (const [index, afterTest] of Object.entries(hooks?.afterTest ?? [])) {
            await afterTest(page);
            if (!afterTest.__isGlobal) {
                toRemove.push(+index);
            }
        }
        for (const index of toRemove.reverse()) {
            hooks?.afterTest.splice(index, 1);
        }
        if (index) {
            const hooks = page._safetest_internal?.hooks;
            for (const beforeClose of hooks?.beforeClose ?? []) {
                await beforeClose(page);
            }
            await page.close();
        }
    }
};
exports.afterEachFn = afterEachFn;
const afterAllFn = async () => {
    state_1.state.currentSuite = '';
    await (0, cleanup_browser_1.cleanupBrowser)();
    for (const afterAllDone of state_1.state.afterAllsDone ?? []) {
        await afterAllDone();
    }
    // state.afterAllsDone = [];
};
exports.afterAllFn = afterAllFn;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVhcmRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdGVhcmRvd24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaURBQWlEO0FBQ2pELHVEQUFtRDtBQUNuRCxtQ0FBZ0M7QUFHekIsTUFBTSxXQUFXLEdBQUcsS0FBSyxJQUFJLEVBQUU7SUFDcEMsTUFBTSxLQUFLLEdBQUksYUFBSyxDQUFDLHNCQUFzQixFQUFFLEtBQUssRUFBaUIsSUFBSSxFQUFFLENBQUM7SUFDMUUsS0FBSyxNQUFNLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDbEQsTUFBTSxLQUFLLEdBQUcsQ0FBQyxNQUFNLENBQUM7UUFDdEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixFQUFFLEtBQUssQ0FBQztRQUM3QyxNQUFNLFFBQVEsR0FBYSxFQUFFLENBQUM7UUFDOUIsS0FBSyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFNBQVMsSUFBSSxFQUFFLENBQUMsRUFBRTtZQUN2RSxNQUFNLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QixJQUFJLENBQUUsU0FBaUIsQ0FBQyxVQUFVLEVBQUU7Z0JBQ2xDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN2QjtTQUNGO1FBQ0QsS0FBSyxNQUFNLEtBQUssSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDdEMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ25DO1FBQ0QsSUFBSSxLQUFLLEVBQUU7WUFDVCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDO1lBQzdDLEtBQUssTUFBTSxXQUFXLElBQUksS0FBSyxFQUFFLFdBQVcsSUFBSSxFQUFFLEVBQUU7Z0JBQ2xELE1BQU0sV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3pCO1lBQ0QsTUFBTSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDcEI7S0FDRjtBQUNILENBQUMsQ0FBQztBQXZCVyxRQUFBLFdBQVcsZUF1QnRCO0FBRUssTUFBTSxVQUFVLEdBQUcsS0FBSyxJQUFJLEVBQUU7SUFDbkMsYUFBSyxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7SUFFeEIsTUFBTSxJQUFBLGdDQUFjLEdBQUUsQ0FBQztJQUN2QixLQUFLLE1BQU0sWUFBWSxJQUFJLGFBQUssQ0FBQyxhQUFhLElBQUksRUFBRSxFQUFFO1FBQ3BELE1BQU0sWUFBWSxFQUFFLENBQUM7S0FDdEI7SUFDRCw0QkFBNEI7QUFDOUIsQ0FBQyxDQUFDO0FBUlcsUUFBQSxVQUFVLGNBUXJCIn0=