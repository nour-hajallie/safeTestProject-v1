"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.bootstrap = exports.render = void 0;
const state_1 = require("./state");
const render_1 = require("./render");
const bootstrap_1 = require("./bootstrap");
let renderFn;
const assertAndRender = (element) => {
    if (!renderFn) {
        throw new Error('App is not bootstrapped, did you forget to call `bootstrap({ /* ... */ })`?');
    }
    return renderFn(element);
};
const id = (any) => any;
async function render(elementToRender = id, options = {}) {
    if (typeof elementToRender === 'function' &&
        !elementToRender?.prototype?.constructor?.name &&
        !elementToRender?.prototype?.constructor?.toString().startsWith('class')) {
        const rendered = elementToRender(state_1.state.browserState?.renderElement.value ?? {});
        elementToRender = rendered;
    }
    return (0, render_1.render)({ __isRenderable: true, thing: elementToRender }, options, async (e) => assertAndRender(e.thing));
}
exports.render = render;
const bootstrap = async (args) => {
    renderFn = args.render;
    state_1.state.browserState = {
        retryAttempt: 0,
        renderElement: { __type: 'renderElement', value: args.element },
    };
    return (0, bootstrap_1.bootstrap)({
        ...args,
        defaultRender: () => assertAndRender(args.element),
    });
};
exports.bootstrap = bootstrap;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ZlbHRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3N2ZWx0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFHQSxtQ0FBZ0M7QUFDaEMscUNBQWlFO0FBQ2pFLDJDQUFxRTtBQVdyRSxJQUFJLFFBQTJELENBQUM7QUFDaEUsTUFBTSxlQUFlLEdBQUcsQ0FBQyxPQUFtQixFQUFFLEVBQUU7SUFDOUMsSUFBSSxDQUFDLFFBQVEsRUFBRTtRQUNiLE1BQU0sSUFBSSxLQUFLLENBQ2IsNkVBQTZFLENBQzlFLENBQUM7S0FDSDtJQUNELE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzNCLENBQUMsQ0FBQztBQUVGLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7QUFFdEIsS0FBSyxVQUFVLE1BQU0sQ0FDMUIsa0JBQWtFLEVBQUUsRUFDcEUsVUFBeUIsRUFBRTtJQUUzQixJQUNFLE9BQU8sZUFBZSxLQUFLLFVBQVU7UUFDckMsQ0FBQyxlQUFlLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxJQUFJO1FBQzlDLENBQUMsZUFBZSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxFQUN4RTtRQUNBLE1BQU0sUUFBUSxHQUFJLGVBQXVCLENBQ3ZDLGFBQUssQ0FBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLEtBQUssSUFBSyxFQUFVLENBQ3ZELENBQUM7UUFDRixlQUFlLEdBQUcsUUFBUSxDQUFDO0tBQzVCO0lBRUQsT0FBTyxJQUFBLGVBQVksRUFDakIsRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxlQUFlLEVBQUUsRUFDaEQsT0FBTyxFQUNQLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQ3RDLENBQUM7QUFDSixDQUFDO0FBcEJELHdCQW9CQztBQU9NLE1BQU0sU0FBUyxHQUFHLEtBQUssRUFDNUIsSUFBbUIsRUFDTyxFQUFFO0lBQzVCLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3ZCLGFBQUssQ0FBQyxZQUFZLEdBQUc7UUFDbkIsWUFBWSxFQUFFLENBQUM7UUFDZixhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFO0tBQ2hFLENBQUM7SUFFRixPQUFPLElBQUEscUJBQWUsRUFBQztRQUNyQixHQUFHLElBQUk7UUFDUCxhQUFhLEVBQUUsR0FBRyxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7S0FDbkQsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBYlcsUUFBQSxTQUFTLGFBYXBCIn0=