"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.exposeFunction = void 0;
const exposeFunction = async (page, name, fn) => {
    let resolve = false;
    const timeout = new Promise((r) => setTimeout(r, 100));
    const exposed = page.exposeFunction(name, fn).then(() => (resolve = true));
    return Promise.race([timeout, exposed]).then(async () => {
        if (!resolve) {
            await page.reload();
            // @ts-ignore
            const fn = await page.evaluate((name) => typeof window[name], name);
            if (fn !== 'function')
                return (0, exports.exposeFunction)(page, name, fn);
        }
    });
};
exports.exposeFunction = exposeFunction;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3NlLWZ1bmN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2V4cG9zZS1mdW5jdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFTyxNQUFNLGNBQWMsR0FBRyxLQUFLLEVBQ2pDLElBQVUsRUFDVixJQUFZLEVBQ1osRUFBTyxFQUNRLEVBQUU7SUFDakIsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0lBQ3BCLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdkQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDM0UsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3RELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDWixNQUFNLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNwQixhQUFhO1lBQ2IsTUFBTSxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNwRSxJQUFJLEVBQUUsS0FBSyxVQUFVO2dCQUFFLE9BQU8sSUFBQSxzQkFBYyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDOUQ7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQWhCVyxRQUFBLGNBQWMsa0JBZ0J6QiJ9