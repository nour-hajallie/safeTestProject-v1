{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Bootstrap = exports.bootstrap = exports.render = exports.createOverride = void 0;\nconst render_1 = require(\"./render\");\nconst bootstrap_1 = require(\"./bootstrap\");\nconst state_1 = require(\"./state\");\nconst is_in_node_1 = require(\"./is-in-node\");\nconst react_override_1 = require(\"react-override\");\nconst react_1 = __importDefault(require(\"react\"));\nexports.createOverride = (0, react_override_1.configureCreateOverride)(false);\nlet renderFn;\nconst assertAndRender = element => {\n  if (!renderFn) {\n    throw new Error('App is not bootstrapped, did you forget to call `bootstrap({ /* ... */ })`?');\n  }\n  return renderFn(element);\n};\nasync function render(elementToRender = state_1.state.browserState?.renderElement.value, options = {}) {\n  if (!is_in_node_1.isInNode && typeof elementToRender === 'function') {\n    const rendered = elementToRender(state_1.state.browserState?.renderElement.value ?? {});\n    elementToRender = rendered;\n  }\n  return (0, render_1.render)({\n    __isRenderable: true,\n    thing: elementToRender\n  }, options, async e => {\n    const rendered = assertAndRender(e.thing);\n    await new Promise(r => setTimeout(r, 0));\n    return rendered;\n  });\n}\nexports.render = render;\nconst bootstrap = async args => {\n  renderFn = args.render;\n  state_1.state.browserState = {\n    retryAttempt: 0,\n    renderElement: {\n      __type: 'renderElement',\n      value: args.element\n    }\n  };\n  return (0, bootstrap_1.bootstrap)({\n    ...args,\n    defaultRender: () => assertAndRender(args.element)\n  });\n};\nexports.bootstrap = bootstrap;\nconst Bootstrap = props => {\n  const initial = props.loading ?? props.children;\n  const [child, setChild] = react_1.default.useState(initial);\n  react_1.default.useLayoutEffect(() => {\n    (0, exports.bootstrap)({\n      ...props,\n      element: props.children,\n      render: element => setChild(element)\n    });\n  }, [props.children]);\n  return child || props.children;\n};\nexports.Bootstrap = Bootstrap;","map":{"version":3,"names":["render_1","require","bootstrap_1","state_1","is_in_node_1","react_override_1","react_1","__importDefault","exports","createOverride","configureCreateOverride","renderFn","assertAndRender","element","Error","render","elementToRender","state","browserState","renderElement","value","options","isInNode","rendered","__isRenderable","thing","e","Promise","r","setTimeout","bootstrap","args","retryAttempt","__type","defaultRender","Bootstrap","props","initial","loading","children","child","setChild","default","useState","useLayoutEffect"],"sources":["/Users/nour/Documents/GitHub/safeTestProject-v1/node_modules/safetest/src/react.ts"],"sourcesContent":["import { render as renderCommon, RenderOptions } from './render';\nimport { bootstrap as bootstrapCommon, Importer } from './bootstrap';\nimport { state } from './state';\nimport { isInNode } from './is-in-node';\nimport { configureCreateOverride } from 'react-override';\nimport React from 'react';\n\nexport { Override } from 'react-override';\n\nexport const createOverride = configureCreateOverride(false);\n\nlet renderFn: (element: React.ReactNode) => void;\nconst assertAndRender = (element: React.ReactNode) => {\n  if (!renderFn) {\n    throw new Error(\n      'App is not bootstrapped, did you forget to call `bootstrap({ /* ... */ })`?'\n    );\n  }\n  return renderFn(element);\n};\n\nexport async function render(\n  elementToRender:\n    | React.ReactNode\n    | ((app: React.ReactNode) => React.ReactNode) = state.browserState\n    ?.renderElement.value,\n  options: RenderOptions = {}\n) {\n  if (!isInNode && typeof elementToRender === 'function') {\n    const rendered = elementToRender(\n      state.browserState?.renderElement.value ?? ({} as any)\n    );\n    elementToRender = rendered;\n  }\n\n  return renderCommon(\n    { __isRenderable: true, thing: elementToRender },\n    options,\n    async (e) => {\n      const rendered = assertAndRender(e.thing);\n      await new Promise((r) => setTimeout(r, 0));\n      return rendered;\n    }\n  );\n}\n\ntype BootstrapArgs = Importer & {\n  element: React.ReactNode;\n  render: (e: React.ReactNode) => void;\n};\n\nexport const bootstrap = async (args: BootstrapArgs): Promise<void> => {\n  renderFn = args.render;\n  state.browserState = {\n    retryAttempt: 0,\n    renderElement: { __type: 'renderElement', value: args.element },\n  };\n\n  return bootstrapCommon({\n    ...args,\n    defaultRender: () => assertAndRender(args.element),\n  });\n};\n\nexport const Bootstrap: React.FunctionComponent<\n  React.PropsWithChildren<\n    {\n      /** Note that using this in SSR mode this will cause the page to start with the loading component before the page is ready. */\n      loading?: React.ReactNode;\n    } & Importer\n  >\n> = (props) => {\n  const initial = props.loading ?? props.children;\n  const [child, setChild] = React.useState<React.ReactNode>(initial);\n  React.useLayoutEffect(() => {\n    bootstrap({\n      ...props,\n      element: props.children,\n      render: (element) => setChild(element),\n    });\n  }, [props.children]);\n\n  return child || props.children;\n};\n"],"mappings":";;;;;;;;;;;AAAA,MAAAA,QAAA,GAAAC,OAAA;AACA,MAAAC,WAAA,GAAAD,OAAA;AACA,MAAAE,OAAA,GAAAF,OAAA;AACA,MAAAG,YAAA,GAAAH,OAAA;AACA,MAAAI,gBAAA,GAAAJ,OAAA;AACA,MAAAK,OAAA,GAAAC,eAAA,CAAAN,OAAA;AAIaO,OAAA,CAAAC,cAAc,GAAG,IAAAJ,gBAAA,CAAAK,uBAAuB,EAAC,KAAK,CAAC;AAE5D,IAAIC,QAA4C;AAChD,MAAMC,eAAe,GAAIC,OAAwB,IAAI;EACnD,IAAI,CAACF,QAAQ,EAAE;IACb,MAAM,IAAIG,KAAK,CACb,6EAA6E,CAC9E;;EAEH,OAAOH,QAAQ,CAACE,OAAO,CAAC;AAC1B,CAAC;AAEM,eAAeE,MAAMA,CAC1BC,eAAA,GAEkDb,OAAA,CAAAc,KAAK,CAACC,YAAY,EAChEC,aAAa,CAACC,KAAK,EACvBC,OAAA,GAAyB,EAAE;EAE3B,IAAI,CAACjB,YAAA,CAAAkB,QAAQ,IAAI,OAAON,eAAe,KAAK,UAAU,EAAE;IACtD,MAAMO,QAAQ,GAAGP,eAAe,CAC9Bb,OAAA,CAAAc,KAAK,CAACC,YAAY,EAAEC,aAAa,CAACC,KAAK,IAAK,EAAU,CACvD;IACDJ,eAAe,GAAGO,QAAQ;;EAG5B,OAAO,IAAAvB,QAAA,CAAAe,MAAY,EACjB;IAAES,cAAc,EAAE,IAAI;IAAEC,KAAK,EAAET;EAAe,CAAE,EAChDK,OAAO,EACP,MAAOK,CAAC,IAAI;IACV,MAAMH,QAAQ,GAAGX,eAAe,CAACc,CAAC,CAACD,KAAK,CAAC;IACzC,MAAM,IAAIE,OAAO,CAAEC,CAAC,IAAKC,UAAU,CAACD,CAAC,EAAE,CAAC,CAAC,CAAC;IAC1C,OAAOL,QAAQ;EACjB,CAAC,CACF;AACH;AAvBAf,OAAA,CAAAO,MAAA,GAAAA,MAAA;AA8BO,MAAMe,SAAS,GAAG,MAAOC,IAAmB,IAAmB;EACpEpB,QAAQ,GAAGoB,IAAI,CAAChB,MAAM;EACtBZ,OAAA,CAAAc,KAAK,CAACC,YAAY,GAAG;IACnBc,YAAY,EAAE,CAAC;IACfb,aAAa,EAAE;MAAEc,MAAM,EAAE,eAAe;MAAEb,KAAK,EAAEW,IAAI,CAAClB;IAAO;GAC9D;EAED,OAAO,IAAAX,WAAA,CAAA4B,SAAe,EAAC;IACrB,GAAGC,IAAI;IACPG,aAAa,EAAEA,CAAA,KAAMtB,eAAe,CAACmB,IAAI,CAAClB,OAAO;GAClD,CAAC;AACJ,CAAC;AAXYL,OAAA,CAAAsB,SAAS,GAAAA,SAAA;AAaf,MAAMK,SAAS,GAOjBC,KAAK,IAAI;EACZ,MAAMC,OAAO,GAAGD,KAAK,CAACE,OAAO,IAAIF,KAAK,CAACG,QAAQ;EAC/C,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGnC,OAAA,CAAAoC,OAAK,CAACC,QAAQ,CAAkBN,OAAO,CAAC;EAClE/B,OAAA,CAAAoC,OAAK,CAACE,eAAe,CAAC,MAAK;IACzB,IAAApC,OAAA,CAAAsB,SAAS,EAAC;MACR,GAAGM,KAAK;MACRvB,OAAO,EAAEuB,KAAK,CAACG,QAAQ;MACvBxB,MAAM,EAAGF,OAAO,IAAK4B,QAAQ,CAAC5B,OAAO;KACtC,CAAC;EACJ,CAAC,EAAE,CAACuB,KAAK,CAACG,QAAQ,CAAC,CAAC;EAEpB,OAAOC,KAAK,IAAIJ,KAAK,CAACG,QAAQ;AAChC,CAAC;AAnBY/B,OAAA,CAAA2B,SAAS,GAAAA,SAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}